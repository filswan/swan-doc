# å¼€å‘äººå‘˜å¿«é€Ÿå…¥é—¨

å¤šé“¾å­˜å‚¨ï¼ˆä»¥ä¸‹ç§°ä¸ºâ€œMCSâ€ï¼‰æ˜¯ä¸€å¥—ä»¥å¤ªåŠæ‰©å±•è§£å†³æ–¹æ¡ˆï¼Œå¯å®ç°é«˜ååé‡ã€ä½æˆæœ¬çš„æ™ºèƒ½åˆçº¦ï¼ŒåŒæ—¶ä¿æŒå¯ä¿¡èµ–çš„å®‰å…¨æ€§ã€‚

ä»¥ä¸‹æ–‡æ¡£æè¿°äº†å¦‚ä½•ä½¿ç”¨ MCSï¼Œå®ƒç›®å‰åœ¨ Polygon Mumbai æµ‹è¯•ç½‘ä¸Šè¿è¡Œã€‚ æ— è®ºæ‚¨æ˜¯åªæƒ³å¼€å§‹æ„å»ºçš„å¼€å‘äººå‘˜ï¼Œè¿˜æ˜¯æƒ³æ·±å…¥äº†è§£ MCS çš„å†…éƒ¨ç»“æ„åŠå…¶å·¥ä½œåŸç†ï¼Œæ­¤ç«™ç‚¹éƒ½æ˜¯é€‚åˆæ‚¨çš„åœ°æ–¹ã€‚

### ç³»ç»Ÿè®¾è®¡ <a href="#xi-tong-she-ji" id="xi-tong-she-ji"></a>

![](../../.gitbook/assets/WID.png)

### MCS æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿ <a href="#mcs-shi-ru-he-yun-hang-de" id="mcs-shi-ru-he-yun-hang-de"></a>

å¦‚æœæ‚¨æƒ³äº†è§£ MCS çš„è¿è¡ŒåŸç†ï¼Œæœ€å¥½ä» ç”¨æˆ·æŒ‡å—éƒ¨åˆ†å¼€å§‹ï¼Œå®ƒæä¾›äº† MCS å†…éƒ¨ç»“æ„çš„æ¦‚è¿°ã€‚ ä»é‚£é‡Œï¼Œæ‚¨å¯ä»¥è·³è½¬åˆ°æœ‰å…³ç³»ç»Ÿå„ä¸ªç»„ä»¶çš„æ›´è¯¦ç»†çš„è§£é‡Šã€‚

### æ¨¡å— <a href="#mo-kuai" id="mo-kuai"></a>

**ä»£å¸äº¤æ¢ï¼š** ä»£å¸äº¤æ¢æ¨¡å—è´Ÿè´£å°†ç”¨æˆ·çš„ä»£å¸æ¢æˆåŒ…è£¹çš„ä»£å¸ï¼Œå¯ä»¥æ˜¯USDCæˆ–å…¶ä»–ä»£å¸ã€‚

1ã€ç”¨æˆ·åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶æ”¯ä»˜ USDC æˆ–å…¶ä»–ä»£å¸ï¼Œè¿™äº›ä»£å¸ç§°ä¸ºç”¨æˆ·ä»£å¸ã€‚

2ã€MCS åœ¨å°†æ•°æ®å­˜å‚¨åˆ° Filecoin ç½‘ç»œæ—¶ä½¿ç”¨ FILï¼ˆç§°ä¸ºåŒ…è£…ä»£å¸ï¼‰è¿›è¡Œæ”¯ä»˜ã€‚

3ã€ç”¨æˆ·ä»£å¸åº”é€šè¿‡æ­¤æ¨¡å—æ›´æ”¹ä¸ºåŒ…è£…ä»£å¸ï¼Œæ­¤æ­¥éª¤ç§°ä¸ºä»£å¸äº¤æ¢ã€‚

4ã€ä»£å¸äº¤æ¢æ˜¯é€šè¿‡ DEX çš„ Sushi Swap å®Œæˆçš„ã€‚

**æ”¯ä»˜æ¨¡å—ï¼š**

1ã€ä¸Šä¼ æ–‡ä»¶åï¼Œæ ¹æ® ï¼š

* çŸ¿å·¥å¹³å‡ä»·æ ¼
* æ–‡ä»¶å¤§å°
* æŒç»­æ—¶é—´

ç„¶åä¼°è®¡çš„é‡‘é¢å°†è¢«é”å®šåˆ°ä»˜æ¬¾åˆåŒåœ°å€ï¼Œè¯·å‚é˜…[é…ç½®](https://github.com/filswan/multi-chain-payment#Configuration)ã€‚

2ã€åœ¨è§£é”æ­¥éª¤ä¸­ï¼Œé€šè¿‡Swanå¹³å°FILé’±åŒ…å‘Filecoinç½‘ç»œæ”¯ä»˜çš„é‡‘é¢ï¼Œå°†è½¬å…¥MCSæ”¯ä»˜æ¥æ”¶åœ°å€ï¼Œè¯¦è§[é…ç½®](https://github.com/filswan/multi-chain-payment#Configuration)ã€‚

3ã€åœ¨é€€æ¬¾æ­¥éª¤ä¸­ï¼Œé”å®šçš„è¶…é¢æ”¯ä»˜éƒ¨åˆ†å°†è¿”å›åˆ°ç”¨æˆ·é’±åŒ…ã€‚

\*\*Swan Client APIï¼š\*\*å¯ä»¥æ‰¾åˆ°æ›´å¤šä¿¡æ¯ [è¿™é‡Œ](https://github.com/filswan/go-swan-client)ã€‚

\*\*DAO ç­¾åï¼š\*\*å¦‚æœ DAO æ£€æµ‹åˆ°ä¸Šä¼ çš„æ–‡ä»¶å·²è¢«é“¾æ¥ï¼Œåˆ™ä¼šè§¦å‘ç­¾åæ“ä½œã€‚

\*\*Data DAOï¼š\*\*æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ [Flink](https://github.com/filswan/flink)ã€‚

\*\*IPFSï¼š\*\*å¯ä»¥æ‰¾åˆ°æ›´å¤šä¿¡æ¯ [è¿™é‡Œ](https://docs.ipfs.io/)ã€‚

\*\*Filecoinå­˜å‚¨ï¼š\*\*å¯ä»¥æ‰¾åˆ°æ›´å¤šä¿¡æ¯ [è¿™é‡Œ](https://lotus.filecoin.io/docs/set-up/install/)ã€‚

### å¦‚ä½•å¼€å§‹æ„å»º <a href="#ru-he-kai-shi-gou-jian" id="ru-he-kai-shi-gou-jian"></a>

#### å…ˆå†³æ¡ä»¶ <a href="#xian-jue-tiao-jian" id="xian-jue-tiao-jian"></a>

* æ“ä½œç³»ç»Ÿï¼š Ubuntu 20.04 LTS
* Mysql5.5+
* Lotus èŠ‚ç‚¹
* IPFS Client

**Lotus èŠ‚ç‚¹**

* Lotus èŠ‚ç‚¹ç”¨äºåˆ¶ä½œCaræ–‡ä»¶å’Œå‘é€ç¦»çº¿äº¤æ˜“ã€‚
* åœ¨ä¸ MCS ç›¸åŒçš„æœºå™¨ä¸Šå®‰è£… Lotus èŠ‚ç‚¹æˆ– Lotus lite èŠ‚ç‚¹ã€‚
* Lotuså…¨èŠ‚ç‚¹ç›¸å¯¹äºLotusè½»èŠ‚ç‚¹æ¥è¯´å¤ªé‡äº†ï¼Œæ‰€ä»¥é¦–é€‰Lotusè½»èŠ‚ç‚¹ã€‚
* Lotus lite èŠ‚ç‚¹ä¾èµ–äºä¸€ä¸ª Lotus èŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ Lotus lite èŠ‚ç‚¹æ—¶è¦ç¡®ä¿æŸä¸ªåœ°æ–¹æœ‰ä¸€ä¸ª Lotus èŠ‚ç‚¹ã€‚

**Option1ï¸âƒ£** [å®‰è£…Lotuså…¨èŠ‚ç‚¹](https://lotus.filecoin.io/docs/set-up/install/)

\*\*é€‰é¡¹2ï¸âƒ£ \*\*[å®‰è£…Lotusè½»èŠ‚ç‚¹](https://lotus.filecoin.io/docs/set-up/lotus-lite/#amd-and-intel-based-computers)

#### å®‰è£… <a href="#an-zhuang" id="an-zhuang"></a>

\*\*é€‰é¡¹1ï¸âƒ£ é¢„æ„å»ºåŒ…ï¼š\*\*è¯·å‚é˜…[**release assets**](https://github.com/filswan/multi-chain-payment/releases)èµ„äº§

```shell
wget https://github.com/filswan/multi-chain-payment/releases/tag/v1.0.1/install.sh
./install.sh
```

**é€‰é¡¹2ï¸âƒ£ æºä»£ç **

ğŸ””**go 1.16+** ä¸ºå¿…å¡«é¡¹

```shell
git clone https://github.com/filswan/multi-chain-payment.git
cd multi-chain-payment
git checkout <release_branch>
./build_from_source.sh
```

#### å®‰è£…å <a href="#an-zhuang-hou" id="an-zhuang-hou"></a>

* åœ¨æ‰§è¡Œä¹‹å‰ï¼Œæ‚¨åº”è¯¥åœ¨ `~/.swan/mcp/config.toml` ä¸­æ£€æŸ¥æ‚¨çš„é…ç½®ï¼Œä»¥ç¡®ä¿å®ƒæ˜¯æ­£ç¡®çš„ã€‚

```shell
vi ~/.swan/mcp/config.toml
```

* åœ¨æ‰§è¡Œä¹‹å‰ï¼Œæ‚¨åº”è¯¥åœ¨ `~/.swan/mcp/.env` ä¸­æ£€æŸ¥æ‚¨çš„ç¯å¢ƒå˜é‡ï¼Œä»¥ç¡®ä¿å®ƒæ˜¯æ­£ç¡®çš„ã€‚

```shell
vi ~/.swan/mcp/.env
```

* åœ¨ç›¸å…³æ–‡ä»¶ä¸­è®¾ç½®é…ç½®å’Œ env å˜é‡åï¼Œæ‚¨å¯ä»¥åœ¨ `./build` ç›®å½•ä¸­è¿è¡Œ`å¤šé“¾æ”¯ä»˜`ã€‚

```shell
./build/multi-chain-payment
```

**æ³¨æ„**

* æ—¥å¿—ä½äºç›®å½• `./logs ä¸­`
* æ‚¨å¯ä»¥åœ¨`./multi-chain-payment`ä¹‹å‰æ·»åŠ  `nohup`ï¼Œä»¥å¿½ç•¥ HUPï¼ˆæŒ‚æ–­ï¼‰ä¿¡å·ï¼Œä»è€Œé¿å…åœ¨æ³¨é”€æ—¶åœæ­¢ã€‚
* ä½ å¯ä»¥åŠ  `>> mcp.log`åœ¨å‘½ä»¤ä¸­è®©æ‰€æœ‰æ—¥å¿—è¾“å‡ºåˆ° `mcp.log`.
* ä½ å¯ä»¥åŠ  `&`åœ¨å‘½ä»¤æœ«å°¾è®©ç¨‹åºåœ¨åå°è¿è¡Œã€‚
* å¦‚ï¼š

```shell
nohup ./multi-chain-payment-0.2.1-rc1-unix >> mcp.log &   #After installation from Option 1
nohup ./build/multi-chain-payment >> ./build/mcp.log &    #After installation from Option 2
```

### é…ç½® <a href="#pei-zhi" id="pei-zhi"></a>

æ‚¨éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶è¾“å…¥æ‚¨çš„é…ç½®å‚æ•°ï¼Œä¸‹é¢å°†ä»‹ç»é…ç½®é¡¹ï¼š

\*\*config.toml \*\*

* **port**ï¼šWeb API ç«¯å£ã€‚
* **release** ï¼šåœ¨å‘å¸ƒæ¨¡å¼ä¸‹å·¥ä½œæ—¶ï¼šå°†æ­¤è®¾ç½®ä¸º trueï¼Œå¦åˆ™è®¾ç½®ä¸º false å’Œç¯å¢ƒã€‚ å˜é‡ GIN\_MODE ä¸é‡Šæ”¾ã€‚
* **swan\_platform\_fil\_wallet** ï¼šç”¨äºåœ¨ Filecoin ç½‘ç»œä¸Šæ”¯ä»˜çš„é’±åŒ…åœ°å€ã€‚
* **filink\_url** ï¼šå¯ä»¥ä»è¿™é‡Œæœç´¢äº¤æ˜“æ•°æ®ã€‚

\*\*Lotus \*\*

* **client\_api\_url** ï¼šlotus å®¢æˆ·ç«¯ web api çš„ URLï¼Œå¦‚ï¼š `http://[ip]:[port]/rpc/v0`ï¼Œä¸€èˆ¬æ¥è¯´ `[port]`æ˜¯ `1234`. è¯·å‚é˜… [Lotus API](https://docs.filecoin.io/reference/lotus-api/#features)
* **client\_access\_token** ï¼šlotus å®¢æˆ·ç«¯ web api çš„è®¿é—®ä»¤ç‰Œã€‚ å®ƒåº”è¯¥å…·æœ‰ç®¡ç†å‘˜è®¿é—®æƒé™ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤ä»æ‚¨çš„ Lotus èŠ‚ç‚¹æœºå™¨è·å–å®ƒ `lotus auth create-token --perm admin`. è¯·å‚é˜… [Obtaining Tokens](https://docs.filecoin.io/build/lotus/api-tokens/#obtaining-tokens)

**ipfs\_server**

* **download\_url\_prefix** ï¼šIPFS æœåŠ¡å™¨ url å‰ç¼€ï¼Œå¦‚ï¼š `http://[ip]:[port]`. å­˜å‚¨Caræ–‡ä»¶ä»¥ä¾›å­˜å‚¨æä¾›å•†ä¸‹è½½ã€‚ Caræ–‡ä»¶ç½‘å€å°†æ˜¯ `[download_url_prefix]/ipfs/[file_hash]`
* **upload\_url\_prefix** ï¼šä¸Šä¼ æ–‡ä»¶çš„IPFSæœåŠ¡å™¨urlï¼Œå¦‚ `http://[ip]:[port]`

**swan\_task**

* **dir\_deal** ï¼šç”¨äºä¿å­˜ç”Ÿæˆçš„ Car æ–‡ä»¶å’Œ CSV çš„è¾“å‡ºç›®å½•ã€‚
* **verify\_deal** : \[true/false] æ­¤ä»»åŠ¡ä¸­çš„äº¤æ˜“æ˜¯å¦ä¸ºçœŸå®æ•°æ®ã€‚
* **fast\_retrieval** : \[true/false] è¡¨ç¤ºæ•°æ®åº”è¯¥å¯ç”¨äºå¿«é€Ÿæ£€ç´¢ã€‚
* **start\_epoch\_hours** : start\_epoch ä»å½“å‰æ—¶é—´å¼€å§‹ä»¥å°æ—¶ä¸ºå•ä½çš„äº¤æ˜“ã€‚
* **expired\_days** ï¼šå­˜å‚¨æä¾›å•†å¯†å°æ•°æ®çš„é¢„æœŸå®Œæˆå¤©æ•°ã€‚
* **max\_price** ï¼šæ„¿æ„ä¸ºæ¯ä¸ª GiB/epoch æ”¯ä»˜ç¦»çº¿äº¤æ˜“çš„æœ€é«˜ä»·æ ¼ã€‚
* **generate\_md5** : \[true/false] æ˜¯å¦ä¸ºæ¯ä¸ªCaræ–‡ä»¶ç”ŸæˆMD5ï¼Œæ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªæ¶ˆè€—èµ„æºçš„åŠ¨ä½œã€‚

**Polygon**

* **rpc\_url** ï¼šæ‚¨çš„Polygonç½‘ç»œ RPC URLã€‚
* **payment\_contract\_address** ï¼šPolygonä¸Šçš„Swanæ”¯ä»˜ç½‘å…³åœ°å€ä»¥é”å®šèµ„é‡‘ã€‚
* **sushi\_dex\_address** : Polygonä¸Šçš„å¯¿å¸åœ°å€ã€‚
* **usdc\_wFil\_pool\_contract** ï¼šä»Polygonä¸Šçš„å¯¿å¸è·å– USDC å’Œ wFil ä¹‹é—´æ±‡ç‡çš„åœ°å€ã€‚
* **dao\_contract\_address** ï¼šPolygonä¸Šçš„Swan DAO åœ°å€ï¼Œç”¨äºæ¥æ”¶ DAO ç­¾åã€‚
* **mcp\_payment\_receiver\_address** ï¼šMCS é’±åŒ…åœ°å€ï¼Œç”¨äºä»è§£é”æ“ä½œä¸­æ¥æ”¶èµ„é‡‘ã€‚
* **gas\_limit** ï¼šäº¤æ˜“çš„Gasé™åˆ¶ã€‚
* **unlock\_interval\_minute** : 2 æ¬¡è§£é”æ“ä½œä¹‹é—´çš„è§£é”é—´éš”ï¼ˆåˆ†é’Ÿï¼‰ï¼Œä¸èƒ½å°äº 1ã€‚

\*\*.env \*\*

* **privateKeyOnPolygon** ï¼šé’±åŒ…çš„ç§é’¥ï¼Œç”¨äºåœ¨Polygonç½‘ç»œä¸Šæ‰§è¡Œåˆçº¦æ–¹æ³•å¹¶æ”¯ä»˜ gasã€‚



### &#x20;<a href="#setup-local-geth-and-rollup-blockchain" id="setup-local-geth-and-rollup-blockchain"></a>

### &#x20;<a href="#hello-arbitrum" id="hello-arbitrum"></a>
